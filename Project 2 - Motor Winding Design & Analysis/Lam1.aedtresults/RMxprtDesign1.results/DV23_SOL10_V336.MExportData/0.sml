//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.89956 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.89956 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.89956 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=4.12072e+007 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.0289114 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=2 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=0.000680323, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.00464621, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.586672 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=2.96095 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=1.26898 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.00136065 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.00208609 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.00208609 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.00929243 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=2 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=4.12072e+007 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.0289114 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-2 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=0.000680323, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.00464621, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.586672 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=2.96095 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=1.26898 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.00136065 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.00208609 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.00208609 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.00929243 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-2 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.00610826, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=2 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 2.46138, 4.92276, 7.38415, 9.84553,\
 12.3069, 14.7683, 17.2297, 19.6911, 22.1524, 24.6138, 27.0752, 29.5366,\
 31.998, 34.4594, 36.9207, 39.3821, 41.8435, 44.3049, 46.7663, 49.2276, 51.689,\
 54.1504, 56.6118, 59.0732, 61.5346, 63.9959, 66.4573, 68.9187, 71.3801,\
 73.8415, 76.3029, 78.7642, 81.2256, 83.687, 86.1484, 88.6098, 91.0712,\
 93.5325, 95.9939, 98.4553, 100.917, 103.378, 105.839, 108.301, 110.762,\
 113.224, 115.685, 118.146, 120.608, 123.069, 1, 0.00616306, 0.00615986,\
 0.00615668, 0.0061535, 0.00615034, 0.00614705, 0.00614077, 0.00613453,\
 0.00612832, 0.00612215, 0.00611537, 0.0061014, 0.00608761, 0.00607399,\
 0.00606054, 0.00604467, 0.00600701, 0.0059461, 0.00588795, 0.00583214,\
 0.00577949, 0.00573425, 0.00569017, 0.00564712, 0.00560499, 0.00556369,\
 0.00552313, 0.00548324, 0.00544395, 0.00540523, 0.00536936, 0.00534122,\
 0.00531332, 0.00528565, 0.00525819, 0.00523093, 0.00520385, 0.00517696,\
 0.00515023, 0.00512366, 0.00510011, 0.00508269, 0.00506533, 0.00504802,\
 0.00503078, 0.00501358, 0.00499644, 0.00497935, 0.00496231, 0.00494532,\
 0.00493167) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 2.46138, 4.92276, 7.38415, 9.84553,\
 12.3069, 14.7683, 17.2297, 19.6911, 22.1524, 24.6138, 27.0752, 29.5366,\
 31.998, 34.4594, 36.9207, 39.3821, 41.8435, 44.3049, 46.7663, 49.2276, 51.689,\
 54.1504, 56.6118, 59.0732, 61.5346, 63.9959, 66.4573, 68.9187, 71.3801,\
 73.8415, 76.3029, 78.7642, 81.2256, 83.687, 86.1484, 88.6098, 91.0712,\
 93.5325, 95.9939, 98.4553, 100.917, 103.378, 105.839, 108.301, 110.762,\
 113.224, 115.685, 118.146, 120.608, 123.069, 1, 0.00557263, 0.00555604,\
 0.00553968, 0.00552353, 0.0055076, 0.00549124, 0.00546039, 0.00543031,\
 0.00540095, 0.00537228, 0.00534138, 0.00527943, 0.00522046, 0.00516417,\
 0.00511031, 0.00504883, 0.0049106, 0.00470561, 0.00452587, 0.00436403,\
 0.00421842, 0.00409753, 0.00398265, 0.00387264, 0.00376665, 0.00366401,\
 0.00356419, 0.00346678, 0.00337142, 0.00327783, 0.00319146, 0.00312385,\
 0.00305692, 0.00299062, 0.00292489, 0.00285968, 0.00279494, 0.00273066,\
 0.00266678, 0.00260327, 0.00254699, 0.00250533, 0.00246381, 0.00242242,\
 0.00238116, 0.00234001, 0.00229898, 0.00225806, 0.00221724, 0.00217652,\
 0.0021438) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 0.149357, 0.298714, 0.448071,\
 0.597428, 0.732156, 0.86267, 0.991744, 1.1149, 1.23323, 1.35643, 1.47675,\
 1.59541, 1.71323, 1.82797, 1.94371, 2.06174, 2.18765, 2.32579, 2.46339,\
 2.60763, 2.76012, 2.88876, 3.01144, 3.12367, 3.22774, 3.35092, 3.48532,\
 3.64076, 3.82559, 4.00321, 4.18985, 4.35617, 4.60007, 4.8924, 5.21383,\
 5.56209, 6.29277, 6.9994, 7.61727, 8.48828, 15.373, 21.6426, 30.5656, 39.9927,\
 46.3944, 53.074, 60.3125, 69.4453, 80.3637, 97.8873, 1, 0.202464, 0.202464,\
 0.202464, 0.202464, 0.202464, 0.20651, 0.21032, 0.213438, 0.216984, 0.220685,\
 0.222933, 0.225247, 0.227449, 0.229458, 0.231597, 0.233364, 0.234672,\
 0.234988, 0.234032, 0.233235, 0.231931, 0.230073, 0.230295, 0.230955,\
 0.232337, 0.234216, 0.23463, 0.234258, 0.232563, 0.229231, 0.226614, 0.223736,\
 0.222136, 0.216932, 0.210151, 0.202995, 0.195721, 0.177801, 0.164171,\
 0.154824, 0.1425, 0.0865501, 0.0670666, 0.0514451, 0.0423429, 0.0391074,\
 0.0364646, 0.0340938, 0.0313518, 0.0285974, 0.0247137) CONSTANT NOSPLINE" );
}

}
