//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.011747 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.011747 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.011747 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=54.5729 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.00255325 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=4 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=3.24257e-005, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.000217469, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.579844 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=0.010831 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=0.00372381 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.000129703 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.000194766 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.000194766 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.000869874 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=4 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=54.5729 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.00255325 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-4 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=3.24257e-005, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.000217469, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.579844 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=0.010831 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=0.00372381 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.000129703 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.000194766 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.000194766 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.000869874 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-4 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.000283703, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=4 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 59.7651, 119.53, 179.295, 239.06,\
 298.826, 358.591, 418.356, 478.121, 537.886, 597.651, 657.416, 717.181,\
 776.947, 836.712, 896.477, 956.242, 1016.01, 1075.77, 1135.54, 1195.3,\
 1255.07, 1314.83, 1374.6, 1434.36, 1494.13, 1553.89, 1613.66, 1673.42,\
 1733.19, 1792.95, 1852.72, 1912.48, 1972.25, 2032.01, 2091.78, 2151.54,\
 2211.31, 2271.07, 2330.84, 2390.6, 2450.37, 2510.14, 2569.9, 2629.67, 2689.43,\
 2749.2, 2808.96, 2868.73, 2928.49, 2988.26, 1, 0.000296075, 0.000295885,\
 0.000295696, 0.000295507, 0.000295217, 0.00029484, 0.000294465, 0.00029406,\
 0.000293202, 0.00029235, 0.000291503, 0.000289862, 0.000286018, 0.000282078,\
 0.000278285, 0.000275001, 0.000271766, 0.000268575, 0.000265423, 0.000262306,\
 0.000259221, 0.00025631, 0.000254054, 0.000251812, 0.000249582, 0.000247365,\
 0.000245159, 0.000242963, 0.000240959, 0.000239516, 0.000238078, 0.000236643,\
 0.000235212, 0.000233785, 0.000232361, 0.000231151, 0.000230418, 0.000229686,\
 0.000228955, 0.000228224, 0.000227494, 0.000226765, 0.000226037, 0.00022531,\
 0.000224583, 0.000223857, 0.000223131, 0.000222407, 0.000221683, 0.000220959,\
 0.000220237) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 59.7651, 119.53, 179.295, 239.06,\
 298.826, 358.591, 418.356, 478.121, 537.886, 597.651, 657.416, 717.181,\
 776.947, 836.712, 896.477, 956.242, 1016.01, 1075.77, 1135.54, 1195.3,\
 1255.07, 1314.83, 1374.6, 1434.36, 1494.13, 1553.89, 1613.66, 1673.42,\
 1733.19, 1792.95, 1852.72, 1912.48, 1972.25, 2032.01, 2091.78, 2151.54,\
 2211.31, 2271.07, 2330.84, 2390.6, 2450.37, 2510.14, 2569.9, 2629.67, 2689.43,\
 2749.2, 2808.96, 2868.73, 2928.49, 2988.26, 1, 0.000325132, 0.000319476,\
 0.000314359, 0.000309704, 0.000303334, 0.000296131, 0.000289933, 0.000284124,\
 0.00027401, 0.000266044, 0.000259528, 0.000249501, 0.000233069, 0.000220876,\
 0.000211092, 0.000203437, 0.000196334, 0.000189598, 0.00018312, 0.00017683,\
 0.000170681, 0.000164925, 0.000160487, 0.000156088, 0.000151725, 0.00014739,\
 0.000143082, 0.000138795, 0.000134883, 0.000132067, 0.000129258, 0.000126455,\
 0.000123658, 0.000120867, 0.000118081, 0.000115714, 0.000114279, 0.000112844,\
 0.000111411, 0.000109979, 0.000108548, 0.000107118, 0.000105689, 0.000104261,\
 0.000102834, 0.000101408, 9.9983e-005, 9.85586e-005, 9.7135e-005,\
 9.57122e-005, 9.42902e-005) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 3.58138, 6.89154, 10.1375, 13.3573,\
 16.5557, 19.7419, 22.9201, 26.0949, 29.2644, 32.4327, 35.5995, 38.7663,\
 41.9319, 45.0986, 48.268, 51.4418, 54.6218, 57.8087, 61.0038, 64.2089,\
 67.4254, 70.6569, 73.9091, 77.1867, 80.4941, 83.7428, 86.9773, 90.2543,\
 93.5849, 97.0076, 100.72, 104.997, 110.184, 116.726, 124.26, 132.609, 142.456,\
 154.661, 169.048, 186.26, 329.208, 587.236, 769.874, 1298.37, 1919.03,\
 2731.99, 3630.77, 4514.4, 5391.57, 6265.35, 1, 0.00888791, 0.00888791,\
 0.0092377, 0.00941975, 0.00953215, 0.00961332, 0.00967415, 0.00972147,\
 0.00975852, 0.00978934, 0.00981447, 0.00983555, 0.0098532, 0.00986845,\
 0.00988132, 0.00989195, 0.00990043, 0.00990679, 0.00991127, 0.00991396,\
 0.00991483, 0.00991393, 0.00991101, 0.00990558, 0.00989735, 0.00988613,\
 0.00988271, 0.00988116, 0.00987507, 0.00986375, 0.00984386, 0.00979711,\
 0.00970117, 0.00953333, 0.00927177, 0.00896577, 0.00864134, 0.00826742,\
 0.00782081, 0.00734352, 0.00683581, 0.00425434, 0.00260183, 0.00214998,\
 0.0013729, 0.000995221, 0.000745676, 0.000596156, 0.000507672, 0.000448692,\
 0.000406438) CONSTANT NOSPLINE" );
}

}
