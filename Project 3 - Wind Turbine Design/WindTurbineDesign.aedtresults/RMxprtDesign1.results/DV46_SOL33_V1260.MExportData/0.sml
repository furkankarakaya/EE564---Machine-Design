//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.0117702 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.0117702 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.0117702 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=53.1476 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.00254663 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=4 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=3.08656e-005, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.000207006, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.579844 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=0.0102896 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=0.00353769 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.000123462 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.000185396 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.000185396 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.000828023 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=4 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=53.1476 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.00254663 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-4 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=3.08656e-005, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.000207006, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.579844 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=0.0102896 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=0.00353769 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.000123462 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.000185396 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.000185396 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.000828023 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-4 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.000283528, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=4 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 62.5781, 125.156, 187.734, 250.312,\
 312.89, 375.469, 438.047, 500.625, 563.203, 625.781, 688.359, 750.937,\
 813.515, 876.093, 938.671, 1001.25, 1063.83, 1126.41, 1188.98, 1251.56,\
 1314.14, 1376.72, 1439.3, 1501.87, 1564.45, 1627.03, 1689.61, 1752.19,\
 1814.76, 1877.34, 1939.92, 2002.5, 2065.08, 2127.65, 2190.23, 2252.81,\
 2315.39, 2377.97, 2440.55, 2503.12, 2565.7, 2628.28, 2690.86, 2753.44,\
 2816.01, 2878.59, 2941.17, 3003.75, 3066.33, 3128.9, 1, 0.000295733,\
 0.000295543, 0.000295355, 0.000295166, 0.000294864, 0.000294488, 0.000294114,\
 0.000293637, 0.000292784, 0.000291936, 0.000291094, 0.000288887, 0.000284898,\
 0.000281006, 0.000277414, 0.00027417, 0.000270975, 0.000267824, 0.000264712,\
 0.000261636, 0.000258592, 0.000256072, 0.000253845, 0.00025163, 0.000249429,\
 0.00024724, 0.000245063, 0.000242896, 0.000241363, 0.000239938, 0.000238518,\
 0.000237101, 0.000235688, 0.000234279, 0.000232922, 0.000232197, 0.000231472,\
 0.000230749, 0.000230026, 0.000229305, 0.000228584, 0.000227864, 0.000227144,\
 0.000226426, 0.000225708, 0.000224991, 0.000224274, 0.000223559, 0.000222844,\
 0.00022213, 0.000221416) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 62.5781, 125.156, 187.734, 250.312,\
 312.89, 375.469, 438.047, 500.625, 563.203, 625.781, 688.359, 750.937,\
 813.515, 876.093, 938.671, 1001.25, 1063.83, 1126.41, 1188.98, 1251.56,\
 1314.14, 1376.72, 1439.3, 1501.87, 1564.45, 1627.03, 1689.61, 1752.19,\
 1814.76, 1877.34, 1939.92, 2002.5, 2065.08, 2127.65, 2190.23, 2252.81,\
 2315.39, 2377.97, 2440.55, 2503.12, 2565.7, 2628.28, 2690.86, 2753.44,\
 2816.01, 2878.59, 2941.17, 3003.75, 3066.33, 3128.9, 1, 0.000296969,\
 0.000291586, 0.000286712, 0.000282276, 0.000275916, 0.000269083, 0.000263197,\
 0.000256742, 0.000247339, 0.000239908, 0.000233818, 0.000221662, 0.000206718,\
 0.000195961, 0.000187563, 0.000180668, 0.000174266, 0.000168197, 0.000162363,\
 0.000156702, 0.000151171, 0.000146631, 0.000142636, 0.00013868, 0.000134757,\
 0.000130862, 0.000126992, 0.000123143, 0.000120422, 0.000117892, 0.000115369,\
 0.000112853, 0.000110343, 0.000107838, 0.000105426, 0.000104136, 0.000102848,\
 0.000101561, 0.000100275, 9.89897e-005, 9.77058e-005, 9.6423e-005,\
 9.51412e-005, 9.38603e-005, 9.25804e-005, 9.13014e-005, 9.00232e-005,\
 8.87459e-005, 8.74695e-005, 8.61938e-005, 8.49189e-005) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 3.59007, 6.90131, 10.1485, 13.3701,\
 16.5692, 19.756, 22.9357, 26.1115, 29.2822, 32.452, 35.6203, 38.7885, 41.956,\
 45.1252, 48.2976, 51.475, 54.6602, 57.8514, 61.0539, 64.2674, 67.4943,\
 70.7419, 74.0127, 77.3113, 80.5838, 83.8073, 87.0689, 90.3807, 93.7699,\
 97.3969, 101.577, 106.652, 113.141, 120.469, 128.305, 137.569, 148.991,\
 163.042, 180.488, 202.599, 411.836, 610.287, 841.635, 1398.06, 2095.91,\
 2987.1, 3891.61, 4784.35, 5671.77, 6556.29, 1, 0.0088664, 0.0088664,\
 0.00922462, 0.00940954, 0.00952302, 0.00960548, 0.00966725, 0.00971485,\
 0.00975231, 0.00978339, 0.00980863, 0.00982981, 0.00984756, 0.00986279,\
 0.0098755, 0.00988589, 0.00989405, 0.00989983, 0.00990395, 0.00990582,\
 0.00990579, 0.00990381, 0.00989911, 0.00989171, 0.0098814, 0.00987512,\
 0.00987511, 0.00987076, 0.00986126, 0.0098443, 0.00980451, 0.00971437,\
 0.00955058, 0.0092842, 0.00898366, 0.00868306, 0.00832977, 0.00790479,\
 0.0074188, 0.00687805, 0.00628454, 0.00340078, 0.00250355, 0.00196666,\
 0.001275, 0.000911234, 0.000681995, 0.000556198, 0.000479026, 0.000426525,\
 0.000388402) CONSTANT NOSPLINE" );
}

}
