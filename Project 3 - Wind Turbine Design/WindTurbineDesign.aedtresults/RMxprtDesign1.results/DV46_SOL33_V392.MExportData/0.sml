//         Left: A B C N
//        Right: ROT1 ROT2 Pos

// A           : Phase A
// B           : Phase B
// C           : Phase C
// N           : Neutral
// ROT1        : Mechanical plus
// ROT2        : Mechanical minus
// Pos         : Position

MODELDEF Setup1
{
PORT electrical: A;
PORT electrical: B;
PORT electrical: C;
PORT electrical: N;
PORT ROTATIONAL_V: ROT1;
PORT ROTATIONAL_V: ROT2;
PORT REAL OUT ANGLE[deg]: Pos = VM_Pos.V;
PORT REAL IN ANGLE[deg]: IniPos = 0;

INTERN  R        Ra  N1:=A, N2:=N0_1  ( R:=0.00970927 ); 
INTERN  R        Rb  N1:=B, N2:=N0_2  ( R:=0.00970927 ); 
INTERN  R        Rc  N1:=C, N2:=N0_3  ( R:=0.00970927 ); 
UMODEL Transformation_3To2 AB0 NAP:=N0_1, NAN:=N, NBP:=N0_2, NBN:=N, NCP:=N0_3, NCN:=N, NALPHA:=alpha, NBETA:=beta, NZERO:=zero () SRC: DLL( File:="Transformation.dll");

INTERN  EV       Speed  N1:=NM_1, N2:=GND  ( QUANT:=Torq.V, FACT:=1 ); 
INTERN  II       Torq  N1:=NM_6, N2:=NM_5  ( QUANT:=Speed.I, FACT:=1 ); 
UMODEL D2D D2D1 N1:=NM_5, N2:=ROT1 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
UMODEL D2D D2D2 N1:=NM_6, N2:=ROT2 ( NATURE_1:="electrical", NATURE_2:="Rotational_V" ) SRC: DLL( File:="Domains.dll");
INTERN  VM       VM_Pos  N1:=NM_2, N2:=GND  ; 
MODEL Setup1_AB0 model1 N_1:=alpha, N_2:=beta, N_3:=zero, N_4:=NM_1, N_5:=NM_2 ( pos0:=IniPos );


//         Left: N_1 N_2 N_3
//        Right: N_4 N_5

MODELDEF Setup1_AB0
{
PORT electrical: N_1;
PORT electrical: N_4;
PORT electrical: N_2;
PORT electrical: N_5;
PORT electrical: N_3;
PORT REAL IN: pos0 = 0;

INTERN  L        L1d  N1:=N_1, N2:=N_8  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmd  N1:=N_8, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfed  N1:=N_8, N2:=GND  ( R:=66.1318 ); 
INTERN  L        L2d  N1:=N_9, N2:=N_8  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2d  N1:=N_10, N2:=N_9  ( R:=0.00205422 ); 
INTERN  E        B2d  N1:=N_10, N2:=N_11  ( EMF:=4 * N_42.V * N_4.V * L2q.I, PARTDERIV:=1 ); 
INTERN  L        L2td  N1:=N_12, N2:=N_11  ( L:=2.92958e-005, I0:=0 ); 
INTERN  L        L2bd  N1:=N_13, N2:=N_11  ( L:=0.000219208, I0:=0 ); 
INTERN  M        K2d  ( L1:= L2td.L, L2:= L2bd.L, K:=0.549956 ); 
INTERN  R        R2td  N1:=N_14, N2:=N_12  ( R:=0.0127323 ); 
INTERN  R        R2bd  N1:=N_15, N2:=N_13  ( R:=0.0043775 ); 
INTERN  E        B2ttd  N1:=N_14, N2:=N_16  ( EMF:=0.000117183 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2btd  N1:=N_15, N2:=N_17  ( EMF:=0.000176286 * N_4.V * L2tq.I, PARTDERIV:=1 ); 
INTERN  E        B2tbd  N1:=N_16, N2:=N_18  ( EMF:=0.000176286 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        B2bbd  N1:=N_17, N2:=N_18  ( EMF:=0.000876832 * N_4.V * L2bq.I, PARTDERIV:=1 ); 
INTERN  E        Bmd  N1:=N_18, N2:=GND  ( EMF:=4 * N_43.V * N_4.V * Lmq.I, PARTDERIV:=1 ); 
INTERN  L        L1q  N1:=N_2, N2:=N_28  ( L:=N_41.V, I0:=0 ); 
INTERN  L        Lmq  N1:=N_28, N2:=GND  ( L:=N_43.V, I0:=0 ); 
INTERN  R        Rfeq  N1:=N_28, N2:=GND  ( R:=66.1318 ); 
INTERN  L        L2q  N1:=N_29, N2:=N_28  ( L:=N_42.V, I0:=0 ); 
INTERN  R        R2q  N1:=N_30, N2:=N_29  ( R:=0.00205422 ); 
INTERN  E        B2q  N1:=N_30, N2:=N_31  ( EMF:=-4 * N_42.V * N_4.V * L2d.I, PARTDERIV:=1 ); 
INTERN  L        L2tq  N1:=N_32, N2:=N_31  ( L:=2.92958e-005, I0:=0 ); 
INTERN  L        L2bq  N1:=N_33, N2:=N_31  ( L:=0.000219208, I0:=0 ); 
INTERN  M        K2q  ( L1:= L2tq.L, L2:= L2bq.L, K:=0.549956 ); 
INTERN  R        R2tq  N1:=N_34, N2:=N_32  ( R:=0.0127323 ); 
INTERN  R        R2bq  N1:=N_35, N2:=N_33  ( R:=0.0043775 ); 
INTERN  E        B2ttq  N1:=N_34, N2:=N_36  ( EMF:=-0.000117183 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2btq  N1:=N_35, N2:=N_37  ( EMF:=-0.000176286 * N_4.V * L2td.I, PARTDERIV:=1 ); 
INTERN  E        B2tbq  N1:=N_36, N2:=N_38  ( EMF:=-0.000176286 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        B2bbq  N1:=N_37, N2:=N_38  ( EMF:=-0.000876832 * N_4.V * L2bd.I, PARTDERIV:=1 ); 
INTERN  E        Bmq  N1:=N_38, N2:=GND  ( EMF:=-4 * N_43.V * N_4.V * Lmd.I, PARTDERIV:=1 ); 
INTERN  L        L0  N1:=N_3, N2:=GND  ( L:=0.000272008, I0:=0 ); 
INTERN  I        BT  N1:=GND, N2:=N_4  ( IS:=4 * N_43.V * (L2d.I*Lmq.I - L2q.I*Lmd.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Speed  N1:=N_4, N2:=GND  ; 
INTERN  IV       Gx  N1:=GND, N2:=N_55  ( QUANT:=VM_Speed.V, FACT:=1 ); 
INTERN  C        Cx  N1:=N_55, N2:=GND  ( C:=1, V0:=pos0*0.0174533 ); 
INTERN  VM       VM_Pos  N1:=N_55, N2:=GND  ; 
INTERN  EV       Ex2  N1:=GND, N2:=N_5  ( QUANT:=VM_Pos.V, FACT:=57.2958 ); 
INTERN  E        BIsr  N1:=GND, N2:=N_39  ( EMF:=sqrt(L1d.I*L1d.I + L1q.I*L1q.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Isr  N1:=N_39, N2:=GND  ; 
INTERN  E        BIm  N1:=GND, N2:=N_40  ( EMF:=sqrt(Lmd.I*Lmd.I + Lmq.I*Lmq.I), PARTDERIV:=1 ); 
INTERN  VM       VM_Im  N1:=N_40, N2:=GND  ; 
INTERN  VM       VM_L1  N1:=N_41, N2:=GND  ; 
INTERN  NDSRC    PL1 N0:=N_41, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l1_table pwl TABLE=( 51, 0, 66.7916, 133.583, 200.375, 267.167,\
 333.958, 400.75, 467.542, 534.333, 601.125, 667.916, 734.708, 801.5, 868.291,\
 935.083, 1001.87, 1068.67, 1135.46, 1202.25, 1269.04, 1335.83, 1402.62,\
 1469.42, 1536.21, 1603, 1669.79, 1736.58, 1803.37, 1870.17, 1936.96, 2003.75,\
 2070.54, 2137.33, 2204.12, 2270.92, 2337.71, 2404.5, 2471.29, 2538.08,\
 2604.87, 2671.67, 2738.46, 2805.25, 2872.04, 2938.83, 3005.62, 3072.42,\
 3139.21, 3206, 3272.79, 3339.58, 1, 0.000672488, 0.000665318, 0.000646173,\
 0.000555551, 0.000475434, 0.000417634, 0.000373369, 0.000341708, 0.000322559,\
 0.000303462, 0.000284409, 0.000273809, 0.000263543, 0.000253286, 0.000246391,\
 0.000241575, 0.000236761, 0.000231949, 0.000227139, 0.000222331, 0.000217524,\
 0.000212719, 0.000207916, 0.000203114, 0.000198314, 0.000193515, 0.000188718,\
 0.000183923, 0.000179129, 0.000174336, 0.000169544, 0.000164754, 0.000159965,\
 0.000155178, 0.000150391, 0.000145606, 0.000140822, 0.00013604, 0.000131258,\
 0.000126477, 0.000121698, 0.000116919, 0.000112142, 0.000107365, 0.00010259,\
 9.78151e-005, 9.30415e-005, 8.82688e-005, 8.3497e-005, 7.8726e-005,\
 7.39559e-005) CONSTANT NOSPLINE" );
INTERN  VM       VM_L2  N1:=N_42, N2:=GND  ; 
INTERN  NDSRC    PL2 N0:=N_42, N1:=GND  ( QUANT:={N_39.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_l2_table pwl TABLE=( 51, 0, 66.7916, 133.583, 200.375, 267.167,\
 333.958, 400.75, 467.542, 534.333, 601.125, 667.916, 734.708, 801.5, 868.291,\
 935.083, 1001.87, 1068.67, 1135.46, 1202.25, 1269.04, 1335.83, 1402.62,\
 1469.42, 1536.21, 1603, 1669.79, 1736.58, 1803.37, 1870.17, 1936.96, 2003.75,\
 2070.54, 2137.33, 2204.12, 2270.92, 2337.71, 2404.5, 2471.29, 2538.08,\
 2604.87, 2671.67, 2738.46, 2805.25, 2872.04, 2938.83, 3005.62, 3072.42,\
 3139.21, 3206, 3272.79, 3339.58, 1, 0.000715337, 0.000679874, 0.000628952,\
 0.000508986, 0.000417641, 0.000351661, 0.000300891, 0.000264459, 0.000242382,\
 0.000220335, 0.000198313, 0.000186051, 0.000174168, 0.000162289, 0.000154301,\
 0.000148719, 0.000143139, 0.000137559, 0.00013198, 0.000126403, 0.000120826,\
 0.00011525, 0.000109675, 0.0001041, 9.85266e-005, 9.29537e-005, 8.73815e-005,\
 8.181e-005, 7.62392e-005, 7.06691e-005, 6.50996e-005, 5.95307e-005,\
 5.39623e-005, 4.83946e-005, 4.28275e-005, 3.72608e-005, 3.16948e-005,\
 2.61292e-005, 2.05641e-005, 1.49996e-005, 9.43548e-006, 3.87185e-006,\
 -1.69133e-006, -7.25407e-006, -1.28164e-005, -1.83783e-005, -2.39398e-005,\
 -2.95008e-005, -3.50616e-005, -4.06219e-005, -4.61818e-005) CONSTANT NOSPLINE" );
INTERN  VM       VM_Lm  N1:=N_43, N2:=GND  ; 
INTERN  NDSRC    PLm N0:=N_43, N1:=GND  ( QUANT:={N_40.V}, SRC:={vsrc}, TableData:="\
.MODEL Setup1_lm_table pwl TABLE=( 51, 0, 1.21484, 2.12102, 2.95944, 3.7679,\
 4.56193, 5.34048, 6.11012, 6.87484, 7.63604, 8.39573, 9.15307, 9.90908,\
 10.6642, 11.4195, 12.1753, 12.9343, 13.6962, 14.4639, 15.2407, 16.0245,\
 16.817, 17.6199, 18.4338, 19.2635, 20.1148, 20.9889, 21.8908, 22.8285,\
 23.6957, 24.5796, 25.5441, 26.5819, 27.7388, 29.2718, 31.4727, 34.6874,\
 39.5523, 45.6711, 52.4317, 60.3791, 125.698, 427.593, 752.159, 1223.26,\
 2091.97, 3047.98, 4000.76, 4952.87, 5907.99, 6870.66, 1, 0.0262019, 0.0262019,\
 0.0300147, 0.0322673, 0.0337918, 0.0348877, 0.0357619, 0.0364669, 0.0370406,\
 0.0375167, 0.0379133, 0.0382539, 0.0385476, 0.0388029, 0.039024, 0.0392158,\
 0.0393757, 0.0395094, 0.0396131, 0.0396824, 0.0397279, 0.0397484, 0.0397438,\
 0.0397157, 0.0396575, 0.0395617, 0.0394306, 0.0392601, 0.0390418, 0.0389563,\
 0.0388504, 0.0386297, 0.038319, 0.0378683, 0.0369725, 0.0353984, 0.0330355,\
 0.0297769, 0.0264845, 0.0236767, 0.0210874, 0.0111423, 0.00357323, 0.00220061,\
 0.0014572, 0.000912948, 0.000668371, 0.000541024, 0.000462728, 0.000409472,\
 0.000370631) CONSTANT NOSPLINE" );
}

}
